<?xml version='1.0' encoding='UTF-8'?>
<!--Ant script for packagers only-->

<project default='all' name='jajuk' basedir='..'>
  <!-- Only Explicit Release number-->
  <property name='version' value='0.3.4rc1'/>
  <property name='rootdir' value='/tmp/jajuk-dist'/>
  <property name='distdir' value='${rootdir}/jajuk'/>
  <property name='rpmbuilddir_suse' value='${rootdir}/suse/RPMBUILD/'/>
  <property name='rpmbuilddir_mdk' value='${rootdir}/mdk/RPMBUILD/'/>
  <property name='rpmdistdir_suse' value='${rpmbuilddir_suse}/jajuk'/>
  <property name='rpmdistdir_mdk' value='${rpmbuilddir_mdk}/jajuk'/>
  <property name='windowsdir' value='${rootdir}/windows'/>
  <property name='izpackdir' value='${rootdir}/java'/>
  <property name='sourcesdir' value='${rootdir}/src'/>
  <property name='libdir' value='lib'/>
  <property name='nativedir' value='native'/>
  <property name='srcdir' value='src'/>
  <property name='classdir' value='classes'/>
  <property name='javadocdir' value='dist-files/doc/javadoc'/>
  <property name='jarname' value='jajuk.jar'/>
  <property name='helpsetjarname' value='jajuk-help'/>
  <property name='distjarname' value='jajuk-install-'/>
  <property name='sourcesdist' value='${sourcesdir}/jajuk-src-${version}.zip'/>
  <property name='uploaddir' value='${rootdir}/upload'/>
 
  <target name='all' description='o Create the entire package' depends='izpack,rpm,sourcesdist,sfx,prepare_upload'>
  </target>
  
  <target name='clean' description='o Clean up the distribution'>
    <delete dir='${rootdir}'/>
   	<echo message='Building Jajuk release: ${version}'/>
   </target>
  
  <target name='mkdist_izpack' description='o Create the IzPack distribution structure' depends='clean'>
    <mkdir dir='${rootdir}'/>
    <mkdir dir='${distdir}'/>
    <mkdir dir='${izpackdir}'/>
    <copy todir='${distdir}/lib' >
     <fileset dir='${libdir}'/>
  	</copy>
  	<mkdir dir='${distdir}/bin'/>
  	<copy todir='${distdir}/native' >
     <fileset dir='${nativedir}'/>
  	</copy>
  	<mkdir dir='${distdir}/${classdir}'/>
    <copy todir='${distdir}/src' >
     <fileset dir='${srcdir}' />
  	</copy>
  	<copy todir='${distdir}' >
     <fileset file='${basedir}/dist-files/legals/LICENSE.txt'/>
      <fileset dir='${basedir}/dist-files/doc'>
      	<include name='README*.html'/>
      </fileset>
     </copy>
  	<copy todir='${distdir}/src' >
     <fileset file='${basedir}/dist-files/packaging/MANIFEST.MF'/>
  	</copy>
  	<copy todir='${distdir}' >
     <fileset file='${basedir}/scripts/build.xml'/>
  	</copy>
  	<mkdir dir='${distdir}/dist-files'/>
    <copy todir='${distdir}/dist-files' >
     <fileset dir='${basedir}/dist-files'>
     	  <include name='icons/**'/>
     	  <include name='images/jajuk-splashscreen.png'/>
     	  <include name='images/jajuk-logo.ico'/>
     	  <include name='images/jajuk-uninstall.ico'/>
      </fileset>
     </copy>
     <copy todir='${distdir}' >
     	<fileset file='${basedir}/dist-files/icons/64x64/jajuk-logo.png'/>
     </copy>
     <copy todir='${izpackdir}' >
     	<fileset file='/data/java/workspace/jajuk/dist-files/packaging/IzPack/jajuk.izpack'/>
     </copy>
  </target>
  
  
  <target name='mkdist_windows' description='o Create the Windows distribution structure'>
   <mkdir dir='${windowsdir}'/>
      <copy todir='${windowsdir}' >
      	<fileset file='${basedir}/dist-files/packaging/native_launcher/*'/>
     </copy>
  </target>
  
 <target name='replaces' description='o Set a the build time and release into jajuk code and packaging'>
  <!-- Set build date --> 
  <tstamp>
      <format property='build.time' pattern='yyyy/MM/dd HH:mm'/>
  </tstamp>    
  <echo message='Build time: ${build.time}'/>
  <replace dir='${distdir}/${srcdir}/org/jajuk/util' value='${build.time}'>
  	<include name='ITechnicalStrings.java'/>
  	<replacetoken>DATE_REPLACED_BY_ANT</replacetoken>
 </replace>
 <!-- Set release in code--> 
  <replace dir='${distdir}/${srcdir}/org/jajuk/util' value='${version}'>
  	<include name='ITechnicalStrings.java'/>
  	<replacetoken>VERSION_REPLACED_BY_ANT</replacetoken>
 </replace>
 <!-- Set release in IzPack descriptor file--> 
 <replace dir='${izpackdir}' value='${version}'>
  	<include name='jajuk.izpack'/>
  	<replacetoken>VERSION_REPLACED_BY_ANT</replacetoken>
 </replace>
 <!-- Set release in native launcher descriptor file--> 
 <replace dir='${windowsdir}' value='${version}'>
  	<include name='launcher.ini'/>
  	<replacetoken>VERSION_REPLACED_BY_ANT</replacetoken>
 </replace>
 <!-- Set release in Suse RPM descriptor file--> 
 <replace dir='${rpmbuilddir_suse}/SPECS' value='${version}'>
  	<include name='jajuk-suse.spec'/>
  	<replacetoken>VERSION_REPLACED_BY_ANT</replacetoken>
 </replace>
 <!-- Set release in Mdk RPM descriptor file--> 
 <replace dir='${rpmbuilddir_mdk}/SPECS' value='${version}'>
  	<include name='jajuk-mdk.spec'/>
  	<replacetoken>VERSION_REPLACED_BY_ANT</replacetoken>
 </replace>
 <!-- Set release in user build.xml file--> 
 <replace dir='${distdir}' value='${version}'>
  	<include name='build.xml'/>
  	<replacetoken>VERSION_REPLACED_BY_ANT</replacetoken>
 </replace>
 </target>
  
 <target name='mkdist_rpm' description='o Create the RPM distribution structure' depends='clean'>
    <!-- Create structure-->
    	<!--Suse-->
    <mkdir dir='${rootdir}'/>
    <mkdir dir='${rpmbuilddir_suse}'/>
    <mkdir dir='${rpmbuilddir_suse}/tmp'/>
    <mkdir dir='${rpmbuilddir_suse}/SRMPS'/>
    <mkdir dir='${rpmbuilddir_suse}/RPMS'/>
    <mkdir dir='${rpmbuilddir_suse}/SPECS'/>
    <mkdir dir='${rpmbuilddir_suse}/BUILD'/>
    <mkdir dir='${rpmdistdir_suse}'/>
    <mkdir dir='${rpmdistdir_suse}/usr/bin'/>
    <mkdir dir='${rpmdistdir_suse}/usr/lib/jajuk/bin'/>
    <mkdir dir='${rpmdistdir_suse}/usr/lib/jajuk/lib'/>
    <mkdir dir='${rpmdistdir_suse}/usr/lib/jajuk/native'/>
    <mkdir dir='${rpmdistdir_suse}/usr/share/applications'/>
    <mkdir dir='${rpmdistdir_suse}/usr/share/doc/packages/jajuk'/>
    <mkdir dir='${rpmdistdir_suse}/usr/share/pixmaps'/>
    	<!--Mandrake-->
    <mkdir dir='${rpmbuilddir_mdk}'/>
    <mkdir dir='${rpmbuilddir_mdk}/tmp'/>
    <mkdir dir='${rpmbuilddir_mdk}/SRMPS'/>
    <mkdir dir='${rpmbuilddir_mdk}/RPMS'/>
    <mkdir dir='${rpmbuilddir_mdk}/SPECS'/>
    <mkdir dir='${rpmbuilddir_mdk}/BUILD'/>
    <mkdir dir='${rpmdistdir_mdk}'/>
    <mkdir dir='${rpmdistdir_mdk}/usr/bin'/>
    <mkdir dir='${rpmdistdir_mdk}/usr/lib/jajuk/bin'/>
    <mkdir dir='${rpmdistdir_mdk}/usr/lib/jajuk/lib'/>
    <mkdir dir='${rpmdistdir_mdk}/usr/lib/jajuk/native'/>
    <mkdir dir='${rpmdistdir_mdk}/usr/share/applications'/>
    <mkdir dir='${rpmdistdir_mdk}/usr/share/doc/jajuk'/>
    <mkdir dir='${rpmdistdir_mdk}/usr/share/icons/mini'/>
    <mkdir dir='${rpmdistdir_mdk}/usr/share/icons/large'/>
    <mkdir dir='${rpmdistdir_mdk}/usr/lib/menu'/>
    
    <!-- Copy files -->
    	<!--Suse-->
    <copy todir='${rpmbuilddir_suse}/SPECS' >
    	<fileset file='${basedir}/dist-files/packaging/RPMS/suse/jajuk-suse.spec'/>
    </copy>
    <copy todir='${rpmdistdir_suse}/usr/bin' >
    	<fileset file='${basedir}/scripts/jajuk'/>
    </copy>
    <chmod file='${rpmdistdir_suse}/usr/bin/jajuk' perm='ugo+rx'/>
    <copy todir='${rpmdistdir_suse}/usr/lib/jajuk/lib' >
    	<fileset dir='${basedir}/lib'/>
    </copy>
    <copy todir='${rpmdistdir_suse}/usr/lib/jajuk/native' >
    	<fileset file='${basedir}/native/*.so'/>
    </copy>
    <copy todir='${rpmdistdir_suse}/usr/share/applications' >
    	<fileset file='${basedir}/dist-files/packaging/RPMS/suse/Jajuk.desktop'/>
    </copy>
    <chmod file='${rpmdistdir_suse}/usr/share/applications/Jajuk.desktop' perm='ugo+rwx'/>
    <copy todir='${rpmdistdir_suse}/usr/share/doc/packages/jajuk' >
    	<fileset file='${basedir}/dist-files/doc/README*.html'/>
    </copy>
    <copy todir='${rpmdistdir_suse}/usr/share/pixmaps' >
    	<fileset file='${basedir}/dist-files/icons/64x64/jajuk-logo.png'/>
    </copy>
        	<!--Mandrake-->
    <copy todir='${rpmbuilddir_mdk}/SPECS' >
    	<fileset file='${basedir}/dist-files/packaging/RPMS/mdk/jajuk-mdk.spec'/>
    </copy>
    <copy todir='${rpmdistdir_mdk}/usr/bin' >
    	<fileset file='${basedir}/scripts/jajuk'/>
    </copy>
    <chmod file='${rpmdistdir_mdk}/usr/bin/jajuk' perm='ugo+rx'/>
    <copy todir='${rpmdistdir_mdk}/usr/lib/jajuk/lib' >
    	<fileset dir='${basedir}/lib'/>
    </copy>
    <copy todir='${rpmdistdir_mdk}/usr/lib/jajuk/native' >
    	<fileset file='${basedir}/native/*.so'/>
    </copy>
    <copy todir='${rpmdistdir_mdk}/usr/share/doc/jajuk' >
    	<fileset file='${basedir}/dist-files/doc/README*.html'/>
    </copy>
    <copy todir='${rpmdistdir_mdk}/usr/share/icons' >
    	<fileset file='${basedir}/dist-files/packaging/RPMS/mdk/icons/32x32/jajuk-logo.png'/>
    </copy>
    <copy todir='${rpmdistdir_mdk}/usr/share/icons/mini' >
    	<fileset file='${basedir}/dist-files/packaging/RPMS/mdk/icons/16x16/jajuk-logo.png'/>
    </copy>
    <copy todir='${rpmdistdir_mdk}/usr/share/icons/large' >
    	<fileset file='${basedir}/dist-files/packaging/RPMS/mdk/icons/48x48/jajuk-logo.png'/>
    </copy>
    <copy todir='${rpmdistdir_mdk}/usr/lib/menu' >
    	<fileset file='${basedir}/dist-files/packaging/RPMS/mdk/jajuk'/>
    </copy>
        	
  </target>
 
 
 <target name='compile' description='o Compile the code' depends='mkdist_izpack,mkdist_rpm,mkdist_windows,replaces'>
    <javac destdir='${distdir}/${classdir}' deprecation='true' debug='true' optimize='true' excludes='**/package.html'>
      <src>
        <pathelement path='${distdir}/${srcdir}'>
        </pathelement>
      </src>
      <classpath>
        <fileset dir='${distdir}/lib'>
          <include name='*.jar'>
          </include>
        </fileset>
      </classpath>
    </javac>
    <mkdir dir='${distdir}/${classdir}/org/jajuk/icons'/>
    <mkdir dir='${distdir}/${classdir}/org/jajuk/images'/>
  	<mkdir dir='${distdir}/${classdir}/org/jajuk/docs'/>
  	<copy todir='${distdir}/${classdir}/org/jajuk/icons' >
     <fileset dir='${basedir}/dist-files/icons'/>
  	</copy>
  	<copy todir='${distdir}/${classdir}/org/jajuk/images'>
     <fileset file='${distdir}/dist-files/images/*'/>
   </copy>
  	<copy todir='${distdir}/${classdir}/org/jajuk/docs' >
     <fileset file='${basedir}/dist-files/doc/about.html'/>
  	</copy>
  	<copy todir='${distdir}' >
     <fileset file='${basedir}/scripts/jajuk.sh'/>
     <fileset file='${basedir}/scripts/jajuk.bat'/>
  	</copy>
  	<copy todir='${distdir}/${classdir}/org/jajuk/i18n' >
     <fileset file='${basedir}/src/org/jajuk/i18n/*.properties'/>
  	</copy>
  	<copy todir='${distdir}/${classdir}' >
     <fileset file='${basedir}/src/log4j.properties'/>
  	</copy>
  </target>
 

  <target name='jar' description='o Create the jar' depends='compile'>
    <jar jarfile='${distdir}/bin/${jarname}' excludes='**/package.html' basedir='${distdir}/${classdir}' manifest='${basedir}/dist-files/packaging/MANIFEST.MF' compress='true'/>
    <delete dir='${distdir}/${classdir}'/>
	<!-- Copy jajuk jar in the workspace -->
    <copy todir='${basedir}' >
     <fileset file='${distdir}/bin/${jarname}'/>
  	</copy>
  	<!-- Copy jajuk jar in the RPM distdir -->
  	<copy todir='${rpmdistdir_suse}/usr/lib/jajuk/bin' >
    	<fileset file='${distdir}/bin/${jarname}'/>
    </copy>
    <copy todir='${rpmdistdir_mdk}/usr/lib/jajuk/bin' >
    	<fileset file='${distdir}/bin/${jarname}'/>
    </copy>
  </target>


  <target name='helpsetjar' description='o Create the heplset jar' depends='mkdist_izpack'>
    <!--English-->
    <delete file='${distdir}/bin/${helpsetjarname}.jar'/>
    <!-- delete jhindexer-->
    <delete dir='${basedir}/dist-files/doc/jajuk-hs/default/JavaHelpSearch'/>
    <exec executable='/prog/api/jh2.0/javahelp/bin/jhindexer' dir='${basedir}/dist-files/doc/jajuk-hs/default'>
	 <arg line='html'/>
   </exec>
  <jar jarfile='${distdir}/bin/${helpsetjarname}.jar' basedir='${basedir}/dist-files/doc/jajuk-hs/default' />
    <!--French-->
    <delete file='${distdir}/bin/${helpsetjarname}_fr.jar'/>
    <!-- delete jhindexer-->
    <delete dir='${basedir}/dist-files/doc/jajuk-hs/fr/JavaHelpSearch'/>
    <exec executable='/prog/api/jh2.0/javahelp/bin/jhindexer' dir='${basedir}/dist-files/doc/jajuk-hs/fr'>
	 <arg line='html'/>
   </exec>
  <jar jarfile='${distdir}/bin/${helpsetjarname}_fr.jar' basedir='${basedir}/dist-files/doc/jajuk-hs/fr' />
  	<!-- Copy jajuk helpset jars in the RPM distdir -->
  	<copy todir='${rpmdistdir_suse}/usr/lib/jajuk/bin' >
		<fileset file='${distdir}/bin/${helpsetjarname}*.jar'/>
    </copy>
  	<copy todir='${rpmdistdir_mdk}/usr/lib/jajuk/bin' >
		<fileset file='${distdir}/bin/${helpsetjarname}*.jar'/>
    </copy>
   </target>
 
    <target name='sourcesdist' description='o Create the source distribution' depends='helpsetjar'>
	<mkdir dir='${sourcesdir}'/>
    <zip destfile='${sourcesdist}'>
  		<fileset dir='${distdir}/src'/>
  	</zip>
  </target>
    
    <target name='javadoc'>
   	   <delete dir='${javadocdir}'/>
   	  <mkdir dir='${javadocdir}'/>
     <property name='copyright' value='Copyright &amp;copy;  Jajuk team. All Rights Reserved.'/>
     <javadoc destdir='${javadocdir}' access='private' use='true'
            notree='false' nonavbar='false' noindex='false'
            splitindex='true' author='true' version='true'
            nodeprecatedlist='false' nodeprecated='false'
            packagenames='org.jajuk.base,org.jajuk.ui.views,org.jajuk,org.jajuk.i18n,org.jajuk.ui.perspectives,org.jajuk.util.log,org.jajuk.ui,org.jajuk.util,org.jajuk.util.error,org.jajuk.players'
            sourcepath='src'
            Windowtitle='Jajuk ${version} API'   >
		<classpath>
         <fileset dir='${libdir}'>
           <include name='*.jar'>
           </include>
         </fileset>
         <pathelement location='target/${final.name}.jar'/>
       </classpath>
      </javadoc>
    </target>
    
    <target name='rpm' depends='jar,helpsetjar'>
    	<!--Suse-->
    	<copy todir='/home/bflorat' overwrite='yes'>
    		<fileset file='${basedir}/dist-files/packaging/RPMS/suse/.rpmmacros'/>
    	</copy>
 		<rpm specFile='jajuk-suse.spec' topDir='${rpmbuilddir_suse}' cleanBuildDir='yes' removeSpec='no' command='-bb' />
    	<!--Mandrake-->
    	<copy todir='/home/bflorat'  overwrite='yes'>
    		<fileset file='${basedir}/dist-files/packaging/RPMS/mdk/.rpmmacros'/>
    	</copy>
 		<rpm specFile='jajuk-mdk.spec' topDir='${rpmbuilddir_mdk}' cleanBuildDir='yes' removeSpec='no' command='-bb' /> 
 		<!-- Reset .rpmmacros to suse -->
 		<copy todir='/home/bflorat'  overwrite='yes'>
    		<fileset file='${basedir}/dist-files/packaging/RPMS/suse/.rpmmacros'/>
    	</copy>
   </target>
   
   
   <!--IzPack package creation -->
  <taskdef name='izpack' classpath='/prog/IzPack/lib/compiler.jar'
         classname='com.izforge.izpack.ant.IzPackTask'/>
      <target name='izpack' depends='jar,helpsetjar' >
        <echo message='Makes the installer using IzPack'/>
                <izpack input='${izpackdir}/jajuk.izpack'
        output='${izpackdir}/${distjarname}${version}.jar'
        basedir='/data/java/workspace/jajuk'
        izPackDir='/prog/IzPack'/>
      </target>
      
      <!-- Windows SFX creation with 7z-->
    <target name='sfx' depends='izpack'>
  	 <mkdir dir='${windowsdir}'/>
      <copy todir='${windowsdir}' >
     	<fileset file='${izpackdir}/${distjarname}${version}.jar'/>
     </copy>
   	 <exec executable='/bin/sh' dir='${windowsdir}'>
	  <arg line='create_sfx.sh jajuk-${version}.exe'/>
	 </exec>
  </target>    
      
      
      <!-- Prepare upload-->
   <target name='prepare_upload' description='o Put all generated packages in the same upload directory'>
  	 <mkdir dir='${uploaddir}'/>
      <copy todir='${uploaddir}' >
      	<fileset file='${sourcesdist}'/>
     	<fileset file='${rpmbuilddir_suse}/RPMS/noarch/*'/>
     	<fileset file='${rpmbuilddir_mdk}/RPMS/*'/>
     	 <fileset file='${windowsdir}/jajuk-${version}.exe'/>
     	 <fileset file='${izpackdir}/jajuk-install-${version}.jar'/>
     </copy>
 	</target>      
  
</project>