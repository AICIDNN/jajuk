<?xml version='1.0' encoding='UTF-8'?>
<!--Ant script for packagers only-->

<project default='all' name='jajuk' basedir='..'>
  <property name='distdir' value='/tmp/jajuk-dist/jajuk'/>
  <property name='libdir' value='lib'/>
  <property name='srcdir' value='src'/>
  <property name='classdir' value='classes'/>
  <property name='javadocdir' value='dist-files/doc/javadoc'/>
  <property name='version' value='0.2.4'/>
  <property name='jarname' value='jajuk.jar'/>
  <property name='helpsetjarname' value='jajuk-help.jar'/>
  <property name='distjarname' value='jajuk-install-'/>
  
  
  <target name='all' description='o Create the entire package' depends='izpack'/>
  
  <target name='clean' description='o Clean up the distribution'>
    <delete dir='${distdir}'/>
   </target>
  
  <target name='mkdist' description='o Create the distribution structure' depends='clean'>
    <mkdir dir='${distdir}'/>
    <copy todir='${distdir}/lib' >
     <fileset dir='${libdir}'/>
  	</copy>
  	<mkdir dir='${distdir}/bin'/>
  	<copy todir='${distdir}/bin' >
     <fileset file='${basedir}/systray4j.dll'/>
  	</copy>
    <mkdir dir='${distdir}/${classdir}'/>
    <copy todir='${distdir}/src' >
     <fileset dir='${srcdir}' >
     	<exclude name='**/*latin1*'/> 
     </fileset>
  	</copy>
  	<copy todir='${distdir}' >
     <fileset file='${basedir}/dist-files/legals/LICENSE.txt'/>
      <fileset dir='${basedir}/dist-files/doc'>
      	<include name='README*.html'/>
      </fileset>
     </copy>
  	<copy todir='${distdir}/src' >
     <fileset file='${basedir}/dist-files/packaging/MANIFEST.MF'/>
  	</copy>
  	<copy todir='${distdir}' >
     <fileset file='${basedir}/scripts/build.xml'/>
  	</copy>
  	<mkdir dir='${distdir}/dist-files'/>
    <copy todir='${distdir}/dist-files' >
     <fileset dir='${basedir}/dist-files'>
     	  <include name='icons/**'/>
     	  <include name='images/**'/>
      </fileset>
     </copy>
     <copy todir='${distdir}' >
     	<fileset file='${basedir}/dist-files/icons/64x64/jajuk-logo.png'/>
     </copy>
  </target>
  
  <target name='native2ascii' description='Transform i18n resourses bundle to be correctly displayed under eclipse environment' depends='mkdist'>
	<native2ascii encoding='UTF-8' src='${srcdir}/org/jajuk/i18n' dest='${distdir}/${srcdir}/org/jajuk/i18n' includes='*.properties' ext='.tmp'/>     
  	<move file='${distdir}/${srcdir}/org/jajuk/i18n/jajuk.tmp' tofile='${distdir}/${classdir}/org/jajuk/i18n/jajuk-latin1.properties'/>
  	<move file='${distdir}/${srcdir}/org/jajuk/i18n/jajuk_de.tmp' tofile='${distdir}/${classdir}/org/jajuk/i18n/jajuk-latin1_de.properties'/>
  	<move file='${distdir}/${srcdir}/org/jajuk/i18n/jajuk_fr.tmp' tofile='${distdir}/${classdir}/org/jajuk/i18n/jajuk-latin1_fr.properties'/>
  	<move file='${distdir}/${srcdir}/org/jajuk/i18n/jajuk_it.tmp' tofile='${distdir}/${classdir}/org/jajuk/i18n/jajuk-latin1_it.properties'/>
  	<move file='${distdir}/${srcdir}/org/jajuk/i18n/jajuk_nl.tmp' tofile='${distdir}/${classdir}/org/jajuk/i18n/jajuk-latin1_nl.properties'/>
  	<move file='${distdir}/${srcdir}/org/jajuk/i18n/jajuk_sv.tmp' tofile='${distdir}/${classdir}/org/jajuk/i18n/jajuk-latin1_sv.properties'/>
	<delete>
  	 <fileset dir='${distdir}/${srcdir}/org/jajuk/i18n' includes='**/*latin1*,**/*.tmp'/>
    </delete>
  </target>
 
 <target name='compile' description='o Compile the code' depends='native2ascii'>
    <javac destdir='${distdir}/${classdir}' deprecation='true' debug='false' optimize='true' excludes='**/package.html'>
      <src>
        <pathelement path='${distdir}/${srcdir}'>
        </pathelement>
      </src>
      <classpath>
        <fileset dir='${distdir}/lib'>
          <include name='*.jar'>
          </include>
        </fileset>
      </classpath>
    </javac>
    <mkdir dir='${distdir}/${classdir}/org/jajuk/icons'/>
    <mkdir dir='${distdir}/${classdir}/org/jajuk/images'/>
  	<mkdir dir='${distdir}/${classdir}/org/jajuk/docs'/>
  	<copy todir='${distdir}/${classdir}/org/jajuk/icons' >
     <fileset dir='${basedir}/dist-files/icons'/>
  	</copy>
  	<copy todir='${distdir}/${classdir}/org/jajuk/images' >
     <fileset dir='${basedir}/dist-files/images'/>
  	</copy>
  	<copy todir='${distdir}/${classdir}/org/jajuk/docs' >
     <fileset file='${basedir}/dist-files/doc/about.html'/>
  	</copy>
  	<copy todir='${distdir}' >
     <fileset file='${basedir}/scripts/jajuk.sh'/>
     <fileset file='${basedir}/scripts/jajuk.bat'/>
  	</copy>
  </target>
 

  <target name='jar' description='o Create the jar' depends='compile'>
    <jar jarfile='${distdir}/bin/${jarname}' excludes='**/package.html' basedir='${distdir}/${classdir}' manifest='${basedir}/dist-files/packaging/MANIFEST.MF'/>
    <delete dir='${distdir}/${classdir}'/>
    <copy todir='${basedir}' >
     <fileset file='${distdir}/bin/${jarname}'/>
  	</copy>
  </target>

  
  <target name='helpsetjar' description='o Create the heplset jar' depends='mkdist'>
    <delete file='${distdir}/bin/${helpsetjarname}'/>
    <exec executable="jhindexer" dir='${basedir}/dist-files/doc/jajuk-hs/default'>
	 <arg line="html"/>
   </exec>
    <exec executable="jhindexer" dir='${basedir}/dist-files/doc/jajuk-hs/fr'>
	 <arg line="html"/>
   </exec>
   <jar jarfile='${distdir}/bin/${helpsetjarname}' basedir='${basedir}/dist-files/doc/jajuk-hs' />
   <copy todir='${basedir}' >
     <fileset file='${distdir}/bin/${helpsetjarname}'/>
  	</copy>
   </target>
 
   <target name='static_jar' description='o Create the static jar' depends='compile'>
      <unzip dest='${distdir}/${classdir}'>
	      <fileset dir='${distdir}/lib'>
	          <include name='*.jar'>
	          </include>
	        </fileset>
	        </unzip>
	         <delete dir='${distdir}/${classdir}/META-INF'>
		    </delete>
     <jar jarfile='${distdir}/bin/jajuk-${version}.jar' excludes='**/package.html' basedir='${distdir}/${classdir}' manifest='${basedir}/dist-files/packaging/MANIFEST_static.MF'/>
  </target>
  
  <target name='dist-zip' description='o Create a zip distribution' depends='jar'>
      <zip destfile='/tmp/jajuk-dist-${version}.zip' basedir='${distdir}/..'/>
  </target>
  
  
    <target name='javadoc'>
   	   <delete dir='${javadocdir}'/>
   	  <mkdir dir='${javadocdir}'/>
     <property name='copyright' value='Copyright &amp;copy;  Jajuk team. All Rights Reserved.'/>
     <javadoc destdir='${javadocdir}' access='private' use='true'
            notree='false' nonavbar='false' noindex='false'
            splitindex='true' author='true' version='true'
            nodeprecatedlist='false' nodeprecated='false'
            packagenames='org.jajuk.base,org.jajuk.ui.views,org.jajuk,org.jajuk.i18n,org.jajuk.ui.perspectives,org.jajuk.util.log,org.jajuk.ui,org.jajuk.util,org.jajuk.util.error,org.jajuk.players'
            sourcepath='src'
            Windowtitle='Jajuk ${version} API'   >
		<classpath>
         <fileset dir='${libdir}'>
           <include name='*.jar'>
           </include>
         </fileset>
         <pathelement location='target/${final.name}.jar'/>
       </classpath>
      </javadoc>
    </target>
   
  <taskdef name='izpack' classpath='/prog/IzPack/lib/compiler.jar'
         classname='com.izforge.izpack.ant.IzPackTask'/>
      <target name='izpack' depends='jar,helpsetjar' >
        <echo message='Makes the installer using IzPack'/>
                <izpack input='/data/java/workspace/jajuk/dist-files/packaging/jajuk.izpack'
        output='/tmp/${distjarname}${version}.jar'
        basedir='/data/java/workspace/jajuk'
        installerType='standard-kunststoff'
        izPackDir='/prog/IzPack'/>
      </target>
  
</project>