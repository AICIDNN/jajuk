<?xml version='1.0' encoding='UTF-8'?>
<!--Ant script for packagers only-->

<project default='all' name='jajuk' basedir='..'>
  <property name='rootdir' value='/tmp/jajuk-dist'/>
  <property name='distdir' value='${rootdir}/jajuk'/>
  <property name='rpmbuilddir' value='${rootdir}/RPMBUILD/'/>
  <property name='rpmdistdir' value='${rpmbuilddir}/jajuk'/>
  <property name='finaldistdir' value='${rootdir}/dist'/>
  <property name='libdir' value='lib'/>
  <property name='nativedir' value='native'/>
  <property name='srcdir' value='src'/>
  <property name='classdir' value='classes'/>
  <property name='javadocdir' value='dist-files/doc/javadoc'/>
  <property name='version' value='0.3.1'/>
  <property name='jarname' value='jajuk.jar'/>
  <property name='helpsetjarname' value='jajuk-help.jar'/>
  <property name='distjarname' value='jajuk-install-'/>
    
  <target name='all' description='o Create the entire package' depends='izpack,rpm'/>
  
  <target name='clean' description='o Clean up the distribution'>
    <delete dir='${distdir}'/>
    <delete dir='${rpmbuilddir}'/>
    </target>
  
  <target name='mkdist_izpack' description='o Create the IzPack distribution structure' depends='clean'>
    <mkdir dir='${rootdir}'/>
    <mkdir dir='${distdir}'/>
    <copy todir='${distdir}/lib' >
     <fileset dir='${libdir}'/>
  	</copy>
  	<mkdir dir='${distdir}/bin'/>
  	<copy todir='${distdir}/native' >
     <fileset dir='${nativedir}'/>
  	</copy>
  	<mkdir dir='${distdir}/${classdir}'/>
    <copy todir='${distdir}/src' >
     <fileset dir='${srcdir}' />
  	</copy>
  	<copy todir='${distdir}' >
     <fileset file='${basedir}/dist-files/legals/LICENSE.txt'/>
      <fileset dir='${basedir}/dist-files/doc'>
      	<include name='README*.html'/>
      </fileset>
     </copy>
  	<copy todir='${distdir}/src' >
     <fileset file='${basedir}/dist-files/packaging/MANIFEST.MF'/>
  	</copy>
  	<copy todir='${distdir}' >
     <fileset file='${basedir}/scripts/build.xml'/>
  	</copy>
  	<mkdir dir='${distdir}/dist-files'/>
    <copy todir='${distdir}/dist-files' >
     <fileset dir='${basedir}/dist-files'>
     	  <include name='icons/**'/>
     	  <include name='images/jajuk-splashscreen.png'/>
     	  <include name='images/jajuk-logo.ico'/>
     	  <include name='images/jajuk-uninstall.ico'/>
      </fileset>
     </copy>
     <copy todir='${distdir}' >
     	<fileset file='${basedir}/dist-files/icons/64x64/jajuk-logo.png'/>
     </copy>
      <!-- Native installer-->
     <copy todir='${finaldistdir}' >
     	<fileset file='${basedir}/dist-files/packaging/native_launcher/launcher.ini'/>
     	<fileset file='${basedir}/dist-files/packaging/native_launcher/jajuk.stm'/>
     </copy>
  </target>
  
 <target name='mkdist_rpm' description='o Create the RPM distribution structure' depends='clean'>
    <!-- Create structure-->
    <mkdir dir='${rootdir}'/>
    <mkdir dir='${rpmbuilddir}'/>
    <mkdir dir='${rpmbuilddir}/tmp'/>
    <mkdir dir='${rpmbuilddir}/SRMPS'/>
    <mkdir dir='${rpmbuilddir}/RPMS'/>
    <mkdir dir='${rpmbuilddir}/SPECS'/>
    <mkdir dir='${rpmdistdir}'/>
    <mkdir dir='${rpmdistdir}/usr/bin'/>
    <mkdir dir='${rpmdistdir}/usr/lib/jajuk/bin'/>
    <mkdir dir='${rpmdistdir}/usr/lib/jajuk/lib'/>
    <mkdir dir='${rpmdistdir}/usr/lib/jajuk/native'/>
    <mkdir dir='${rpmdistdir}/usr/share/applications'/>
    <mkdir dir='${rpmdistdir}/usr/share/doc/packages/jajuk'/>
    <mkdir dir='${rpmdistdir}/usr/share/pixmaps'/>
    
    <!-- Copy files -->
    <copy todir='${rpmdistdir}/usr/bin' >
    	<fileset file='${basedir}/scripts/jajuk'/>
    </copy>
    <chmod file='${rpmdistdir}/usr/bin/jajuk' perm='ugo+rx'/>
    <copy todir='${rpmdistdir}/usr/lib/jajuk/lib' >
    	<fileset dir='${basedir}/lib'/>
    </copy>
    <copy todir='${rpmdistdir}/usr/lib/jajuk/native' >
    	<fileset file='${basedir}/native/*.so'/>
    </copy>
    <copy todir='${rpmdistdir}/usr/share/applications' >
    	<fileset file='${basedir}/dist-files/packaging/RPMS/Jajuk.desktop'/>
    </copy>
    <chmod file='${rpmdistdir}/usr/share/applications/Jajuk.desktop' perm='ugo+rwx'/>
    <copy todir='${rpmdistdir}/usr/share/doc/packages/jajuk' >
    	<fileset file='${basedir}/dist-files/doc/README*.html'/>
    </copy>
    <copy todir='${rpmdistdir}/usr/share/pixmaps' >
    	<fileset file='${basedir}/dist-files/icons/64x64/jajuk-logo.png'/>
    </copy>
  </target>
 
 
 <target name='compile' description='o Compile the code' depends='mkdist_izpack,mkdist_rpm'>
    <javac destdir='${distdir}/${classdir}' deprecation='true' debug='true' optimize='true' excludes='**/package.html'>
      <src>
        <pathelement path='${distdir}/${srcdir}'>
        </pathelement>
      </src>
      <classpath>
        <fileset dir='${distdir}/lib'>
          <include name='*.jar'>
          </include>
        </fileset>
      </classpath>
    </javac>
    <mkdir dir='${distdir}/${classdir}/org/jajuk/icons'/>
    <mkdir dir='${distdir}/${classdir}/org/jajuk/images'/>
  	<mkdir dir='${distdir}/${classdir}/org/jajuk/docs'/>
  	<copy todir='${distdir}/${classdir}/org/jajuk/icons' >
     <fileset dir='${basedir}/dist-files/icons'/>
  	</copy>
  	<copy todir='${distdir}/${classdir}/org/jajuk/images'>
     <fileset file='${basedir}/dist-files/images/*'/>
   </copy>
  	<copy todir='${distdir}/${classdir}/org/jajuk/docs' >
     <fileset file='${basedir}/dist-files/doc/about.html'/>
  	</copy>
  	<copy todir='${distdir}' >
     <fileset file='${basedir}/scripts/jajuk.sh'/>
     <fileset file='${basedir}/scripts/jajuk.bat'/>
  	</copy>
  	<copy todir='${distdir}/${classdir}/org/jajuk/i18n' >
     <fileset file='${basedir}/src/org/jajuk/i18n/*.properties'/>
  	</copy>
  	<copy todir='${distdir}/${classdir}' >
     <fileset file='${basedir}/src/log4j.properties'/>
  	</copy>
  </target>
 

  <target name='jar' description='o Create the jar' depends='compile'>
    <jar jarfile='${distdir}/bin/${jarname}' excludes='**/package.html' basedir='${distdir}/${classdir}' manifest='${basedir}/dist-files/packaging/MANIFEST.MF'/>
    <delete dir='${distdir}/${classdir}'/>
	<!-- Copy jajuk jar in the workspace -->
    <copy todir='${basedir}' >
     <fileset file='${distdir}/bin/${jarname}'/>
  	</copy>
  	<!-- Copy jajuk jar in the RPM distdir -->
  	<copy todir='${rpmdistdir}/usr/lib/jajuk/bin' >
    	<fileset file='${distdir}/bin/${jarname}'/>
    </copy>
  </target>

  
  <target name='helpsetjar' description='o Create the heplset jar' depends='mkdist_izpack'>
    <delete file='${distdir}/bin/${helpsetjarname}'/>
    <exec executable='jhindexer' dir='${basedir}/dist-files/doc/jajuk-hs/default'>
	 <arg line='html'/>
   </exec>
    <exec executable='jhindexer' dir='${basedir}/dist-files/doc/jajuk-hs/fr'>
	 <arg line='html'/>
   </exec>
   <jar jarfile='${distdir}/bin/${helpsetjarname}' basedir='${basedir}/dist-files/doc/jajuk-hs' />
   <!-- Copy jajuk heplset jar in the workspace -->
    <copy todir='${basedir}' >
     <fileset file='${distdir}/bin/${helpsetjarname}'/>
  	</copy>
  	<!-- Copy jajuk helpset jar in the RPM distdir -->
  	<copy todir='${rpmdistdir}/usr/lib/jajuk/bin' >
		<fileset file='${distdir}/bin/${helpsetjarname}'/>
    </copy>
   </target>
 
   <target name='static_jar' description='o Create the static jar' depends='compile'>
      <unzip dest='${distdir}/${classdir}'>
	      <fileset dir='${distdir}/lib'>
	          <include name='*.jar'>
	          </include>
	        </fileset>
	        </unzip>
	         <delete dir='${distdir}/${classdir}/META-INF'>
		    </delete>
     <jar jarfile='${distdir}/bin/jajuk-${version}.jar' excludes='**/package.html' basedir='${distdir}/${classdir}' manifest='${basedir}/dist-files/packaging/MANIFEST_static.MF'/>
  </target>
  
  <target name='dist-zip' description='o Create a zip distribution' depends='jar'>
      <zip destfile='/tmp/jajuk-dist-${version}.zip' basedir='${distdir}/..'/>
  </target>
  
  
    <target name='javadoc'>
   	   <delete dir='${javadocdir}'/>
   	  <mkdir dir='${javadocdir}'/>
     <property name='copyright' value='Copyright &amp;copy;  Jajuk team. All Rights Reserved.'/>
     <javadoc destdir='${javadocdir}' access='private' use='true'
            notree='false' nonavbar='false' noindex='false'
            splitindex='true' author='true' version='true'
            nodeprecatedlist='false' nodeprecated='false'
            packagenames='org.jajuk.base,org.jajuk.ui.views,org.jajuk,org.jajuk.i18n,org.jajuk.ui.perspectives,org.jajuk.util.log,org.jajuk.ui,org.jajuk.util,org.jajuk.util.error,org.jajuk.players'
            sourcepath='src'
            Windowtitle='Jajuk ${version} API'   >
		<classpath>
         <fileset dir='${libdir}'>
           <include name='*.jar'>
           </include>
         </fileset>
         <pathelement location='target/${final.name}.jar'/>
       </classpath>
      </javadoc>
    </target>
    
    <target name='rpm' depends='jar,helpsetjar'>
    	<copy todir='${rpmbuilddir}/SPECS' file='${basedir}/dist-files/packaging/RPMS/jajuk.specs'/>
    	<rpm specFile='jajuk.specs' topDir='${rpmbuilddir}' cleanBuildDir='yes' removeSpec='no' command='-bb' />
    </target>
   
  <taskdef name='izpack' classpath='/prog/IzPack/lib/compiler.jar'
         classname='com.izforge.izpack.ant.IzPackTask'/>
      <target name='izpack' depends='jar,helpsetjar' >
        <echo message='Makes the installer using IzPack'/>
                <izpack input='/data/java/workspace/jajuk/dist-files/packaging/IzPack/jajuk.izpack'
        output='${finaldistdir}/${distjarname}${version}.jar'
        basedir='/data/java/workspace/jajuk'
        izPackDir='/prog/IzPack'/>
      </target>
  
</project>