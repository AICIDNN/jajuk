#This script generates Jajuk public website
#For first use, launch twice, errors for first launch are normal

#Variables
DOC_SOURCE=/data/java/workspace/jajuk/dist-files/doc
WEBSITE_SOURCE=/data/java/workspace/jajuk_website
XDOC_DEST=/data/projects/jajuk/maven_rep/xdocs
MAVEN_DIR=/data/projects/jajuk/maven_rep
DOC_DEST=$MAVEN_DIR/target/docs
STATCVS_JAR=/prog/api/statcvs-xml-0.9.6-full.jar
XITI_SCRIPT_PATH=/data/scripts
USAGE="Usage: make_jajuk [site] [pdf] [jws <release:default|test>]"

if [ "$1" = "" ]; then
	echo $USAGE
fi

cd /data/projects/jajuk/maven_rep

#### SEND TASK ####
if [ "$1" = "send" ]; then
 cd target/docs
 scp -C -r * bflorat@jajuk.sourceforge.net:/home/groups/j/ja/jajuk/htdocs
 exit 0
fi

### PDF TASK ####
if [ "$1" = "pdf" ]; then
 maven pdf
 exit 0
fi

#### JWS TASK ####
if [ "$1" = "jws" ]; then
 cd /tmp/jajuk-dist/jws
 scp -C -r * bflorat@jajuk.sourceforge.net:/home/groups/j/ja/jajuk/htdocs/jws/$2/
 exit 0
fi

#### SITE TASK ####
if [ "$1" = "site" ]; then

#Cleanup
rm -rf $DOC_DEST/*
rm -rf $XDOC_DEST/*

#Copy doc files

cp -p $WEBSITE_SOURCE/project.xml $MAVEN_DIR
cp -p $WEBSITE_SOURCE/maven.xml $MAVEN_DIR
cp -p $WEBSITE_SOURCE/project.properties $MAVEN_DIR
cp -p $WEBSITE_SOURCE/LICENSE.txt $MAVEN_DIR

mkdir -p $XDOC_DEST/jajuk-hs/default/html
mkdir -p $DOC_DEST/jajuk-hs/default
cp -rp $DOC_SOURCE/images $DOC_DEST/jajuk-hs/default
cp -rp $DOC_SOURCE/icons $DOC_DEST/jajuk-hs/default
cp -rp $DOC_SOURCE/jajuk-hs/default/html/*.html $XDOC_DEST/jajuk-hs/default/html

mkdir -p $XDOC_DEST/jajuk-hs/fr/html
mkdir -p $DOC_DEST/jajuk-hs/fr
cp -rp $DOC_SOURCE/images $DOC_DEST/jajuk-hs/fr
cp -rp $DOC_SOURCE/icons $DOC_DEST/jajuk-hs/fr 
cp -rp $DOC_SOURCE/jajuk-hs/fr/html/*.html $XDOC_DEST/jajuk-hs/fr/html

cp -rp $WEBSITE_SOURCE/flags $DOC_DEST
cp -rp $WEBSITE_SOURCE/specs.pdf $DOC_DEST
cp -rp $WEBSITE_SOURCE/qualification $DOC_DEST
cp -rp $WEBSITE_SOURCE/screenshots $DOC_DEST
cp -rp $DOC_SOURCE/README*.html $DOC_DEST

mkdir -p $DOC_DEST/images/logos
cp -rp $WEBSITE_SOURCE/images/* $DOC_DEST/images/

cp -rp $WEBSITE_SOURCE/new $XDOC_DEST/

cp -rp $WEBSITE_SOURCE/*.html $WEBSITE_SOURCE/*.xml $WEBSITE_SOURCE/*.js $WEBSITE_SOURCE/*.fml $XDOC_DEST
rm $XDOC_DEST/project.xml $XDOC_DEST/maven.xml
#replace official qdwizard page by a notice
cp $WEBSITE_SOURCE/qdwizard_info.html $XDOC_DEST/QDWizard.html

#Sources Checkout
cvs checkout jajuk

#Stats generation (outside maven website because it doesn't work anymore with maven)
cd $MAVEN_DIR
cvs log > cvs.log
java -Xmx256M -jar $STATCVS_JAR -output-dir $XDOC_DEST/statcvs-xml-out -renderer xdoc

#Announcement generation
maven announcement

#Web site generation
maven site

#Replace variables
cd $DOC_DEST
java -cp $XITI_SCRIPT_PATH Xiti SCRIPT_XITI $WEBSITE_SOURCE/script_xiti_home.txt index.html > /tmp/index.html
java -cp $XITI_SCRIPT_PATH Xiti SCRIPT_XITI $WEBSITE_SOURCE/script_xiti_jws.txt jws.html > /tmp/jws.html
java -cp $XITI_SCRIPT_PATH Xiti SCRIPT_XITI $WEBSITE_SOURCE/script_xiti_downloads.txt downloads.html > /tmp/downloads.html
#marche pas Ã  la fin sed -e '\#SCRIPT_XITI#{r/data/scripts/script_xiti' -e ';d;}' ./index.html > /tmp/index.html
cp /tmp/index.html .
cp /tmp/jws.html .
cp /tmp/downloads.html .

#Apply CSS styles
cp $WEBSITE_SOURCE/styles/* $DOC_DEST/style/
#Update PAD file
cp $WEBSITE_SOURCE/jajuk_pad.xml $DOC_DEST
fi
